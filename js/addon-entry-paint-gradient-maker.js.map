{"version":3,"file":"js/addon-entry-paint-gradient-maker.js","sources":["webpack://GUI/./src/addons/addons/paint-gradient-maker/style.css","webpack://GUI/./src/addons/addons/paint-gradient-maker/fill-complex-gradient-enabled.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/add.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/delete.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/_runtime_entry.js","webpack://GUI/./src/addons/addons/paint-gradient-maker/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".paintGradientMakerPopup {\\n  box-sizing: border-box;\\n  width: 528px;\\n  max-height: min(800px, 80vh);\\n  max-width: 85%;\\n  margin-top: 12vh;\\n  overflow-y: auto;\\n  margin-left: auto;\\n  margin-right: auto;\\n}\\n\\n.paintGradientMakerPopupContent {\\n  padding: 1.5rem 2.25rem;\\n}\\n\\n.paintGradientMakerPopupDisplay {\\n  width: 420px;\\n  height: 150px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  margin: 15px 15px 0 15px;\\n  border: solid 1px var(--ui-black-transparent);\\n  border-radius: 5px 5px 0 0;\\n}\\n\\n.paintGradientMakerPopupDraggables {\\n  width: 420px;\\n  height: 40px;\\n  position: relative;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  margin: 0 15px 15px 15px;\\n  border: solid 1px var(--ui-black-transparent);\\n  border-top: none;\\n  border-radius: 0 0 5px 5px;\\n  background: var(--ui-tertiary);\\n}\\n\\n.paintGradientMakerPopupSettings {\\n  border-top: dashed 1px var(--ui-black-transparent);\\n  padding-top: 10px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\n.paintGradientMakerPopupButtons {\\n  margin-top: 1.5rem;\\n}\\n\\n.paintGradientMakerPopupButtons button {\\n  margin-left: 0.5rem;\\n}\\n\\n.paintGradientMakerPopupButtons button:nth-of-type(1) {\\n  color: black;\\n}\\n\", \"\"]);\n\n// exports\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 20 20\\\" fill=\\\"#855cd6\\\"><rect stroke=\\\"#000\\\" fill=\\\"#fff\\\" x=\\\".5\\\" y=\\\".5\\\" width=\\\"19\\\" height=\\\"19\\\" rx=\\\"4\\\" stroke-opacity=\\\".15\\\"/><path d=\\\"M13.35 8.8h-2.4V6.4a1.2 1.2 90 0 0-2.4 0l.043 2.4H6.15a1.2 1.2 90 0 0 0 2.4l2.443-.043L8.55 13.6a1.2 1.2 90 0 0 2.4 0v-2.443l2.4.043a1.2 1.2 90 0 0 0-2.4\\\"/></svg>\\n\"","export default \"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIyIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iIzg1NWNkNiI+PHBhdGggZD0iTTE4IDEwaC00VjZhMiAyIDAgMCAwLTQgMGwuMDcxIDRINmEyIDIgMCAwIDAgMCA0bDQuMDcxLS4wNzFMMTAgMThhMiAyIDAgMCAwIDQgMHYtNC4wNzFMMTggMTRhMiAyIDAgMCAwIDAtNCI+PC9wYXRoPjwvc3ZnPgo=\"","export default \"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIyIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iIzg1NWNkNiI+PHBhdGggZD0iTSAxOCAxMCBoIC00IEggNiBhIDIgMiAwIDAgMCAwIDQgTCAxOCAxNCBhIDIgMiAwIDAgMCAwIC00Ij48L3BhdGg+PC9zdmc+Cg==\"","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./style.css\";\nimport _asset from \"!raw-loader!./fill-complex-gradient-enabled.svg\";\nimport _asset2 from \"!url-loader!./add.svg\";\nimport _asset3 from \"!url-loader!./delete.svg\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"style.css\": _css,\n  \"fill-complex-gradient-enabled.svg\": _asset,\n  \"add.svg\": _asset2,\n  \"delete.svg\": _asset3,\n};\n","// Gradient Maker Addon\n// Original by: SharkPool\nexport default async function ({ addon, console, msg }) {\n    const customID = \"paintGradientMakerSelectButton\";\n    const symbolTag = Symbol(\"custom-gradient-tag\");\n\n    const paperLinkModes = new Set([\n        \"TEXT\", \"OVAL\", \"RECT\", \"ROUNDED_RECT\", \"TRIANGLE\", \"SUSSY\", \"ARROW\"\n    ]);\n\n    let selectedClassName, unselectedClassName, customBtn;\n    let observerUsed = false;\n    let modalStorage = {};\n\n    // Internal utils\n    function position2Angle(p1, p2) {\n        const dx = p1.x - p2.x;\n        const dy = p1.y - p2.y;\n        const angle = Math.atan2(dy, dx) * (180 / Math.PI);\n        return angle + 90;\n    }\n\n    function initGradSelectClasses(gradRow) {\n        const classes = {};\n        const children = Array.from(gradRow.children);\n        for (const child of children) {\n            const name = child.classList.toString();\n            if (classes[name] === undefined) classes[name] = 1;\n            else classes[name] = 0;\n        }\n\n        for (const [cls, count] of Object.entries(classes)) {\n            if (count) selectedClassName = cls;\n            else unselectedClassName = cls\n        }\n    }\n\n    function encodeGradHTML(settings) {\n        const sortedParts = [...settings.parts].sort((a, b) => a.p - b.p);\n\n        let gradString = settings.type === \"Linear\" ? \"linear-gradient(\" : \"radial-gradient(\";\n        if (settings.type === \"Linear\") gradString += `${settings.dir}deg, `;\n        for (const part of sortedParts) gradString += `${part.c} ${part.p}%, `;\n        return gradString.substring(0, gradString.length - 2) + \")\";\n    }\n\n    function genLinearGradPoints(bounds, angleDeg) {\n        const center = bounds.center;\n        const dir = new paper.Point({ angle: angleDeg, length: 1 });\n        const boundsRect = new paper.Path.Rectangle(bounds);\n        const gradLine = new paper.Path.Line({\n            from: center.subtract(dir.multiply(10000)),\n            to: center.add(dir.multiply(10000))\n        });\n\n        const intersections = gradLine.getIntersections(boundsRect);\n        gradLine.remove();\n        boundsRect.remove();\n        if (intersections.length < 2) {\n            return {\n                origin: center.subtract(dir.multiply(bounds.width / 2)),\n                destination: center.add(dir.multiply(bounds.width / 2))\n            };\n        } else {\n            return {\n                origin: intersections[0].point,\n                destination: intersections[1].point\n            };\n        }\n    }\n\n    function setSelected2Grad(settings) {\n        // Compile SVG-based gradient\n        const sortedParts = [...settings.parts].sort((a, b) => a.p - b.p);\n        const gradStops = sortedParts.map(part => new paper.GradientStop(part.c, part.p / 100));\n        const gradient = new paper.Gradient(gradStops, settings.type === \"Radial\");\n        modalStorage._gradCache = { settings, gradient };\n\n        paper.project.getSelectedItems().forEach((item) => {\n            let origin, destination;\n            if (settings.type === \"Radial\") {\n                origin = item.bounds.center;\n                destination = item.bounds.center.add([item.bounds.width / 2, 0]);\n            } else {\n                const points = genLinearGradPoints(item.bounds, settings.dir - 90);\n                origin = points.origin;\n                destination = points.destination;\n            }\n\n            item[settings.path] = { gradient, origin, destination };\n        });\n\n        // Update drawing & action\n        if (paper.tool.onUpdateImage) paper.tool.onUpdateImage();\n\n        // Set with HTML otherwise GUI will crash\n        const swatch = document.querySelectorAll(\n            `div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`\n        )[settings.path === \"fillColor\" ? 0 : 1];\n        if (swatch) swatch.style.background = encodeGradHTML(settings);\n    }\n\n    function paperGrad2CSS(paperGrad) {\n        const { gradient, origin, destination } = paperGrad;\n        if (!gradient || !origin || !destination) return null;\n\n        const stops = gradient.stops.map(s => `${s.color.toCSS(true)} ${Math.round(s.offset * 100)}%`);\n        if (gradient.radial) return `radial-gradient(circle, ${stops.join(\", \")})`;\n        else return `linear-gradient(${position2Angle(destination, origin)}deg, ${stops.join(\", \")})`;\n    }\n\n    function extractGradient(color) {\n        if (!color || !color.gradient) return {};\n        return {\n            gradient: color.gradient,\n            origin: color.origin || \"\",\n            destination: color.destination || color.highlight || \"\"\n        };\n    }\n\n    function decodeSelectedGrad(item, draggableDiv, settingsDiv) {\n        const { gradient, origin, destination } = extractGradient(item[modalStorage.path]);\n        if (!gradient || !origin || !destination) return draggableDiv.append(createDraggable(), createDraggable());\n\n        // Create draggables\n        const newStops = gradient.stops.map((s, i) => {\n            // \"offset\" will be undefined when using Scratch gradients, which dont have set-stops\n            const alpha = Math.round(s.color.alpha * 255).toString(16).padStart(2, \"0\");\n            return createDraggable(s.color.toCSS(true) + alpha, s.offset ? s.offset * 100 : i * 100)\n        });\n        draggableDiv.append(...newStops);\n\n        // Preset values\n        const angle = position2Angle(destination, origin);\n        settingsDiv.querySelector(\"select\").value = gradient.radial ? \"Radial\" : \"Linear\";\n        settingsDiv.querySelector(\"input\").value = angle;\n        modalStorage.type = gradient.radial ? \"Radial\" : \"Linear\";\n        modalStorage.dir = angle;\n    }\n\n    function decodeFromCache(settings, draggableDiv, settingsDiv) {\n        // Create draggables\n        const newStops = settings.parts.map((s, i) => {\n            // \"p\" will be NaN when using Scratch gradients, which dont have set-stops\n            return createDraggable(s.c, isNaN(s.p) ? i * 100 : s.p)\n        });\n        draggableDiv.append(...newStops);\n\n        // Preset values\n        settingsDiv.querySelector(\"select\").value = settings.type;\n        settingsDiv.querySelector(\"input\").value = settings.dir;\n        modalStorage.type = settings.type;\n        modalStorage.dir = settings.dir;\n    }\n\n    function handleFillEvent(paint) {\n        if (!modalStorage._gradCache) return;\n\n        // Set the GUI gradient mode to linear so we can position our gradients\n        paint.fillMode.gradientType = \"HORIZONTAL\";\n        paint.color.fillColor.gradientType = \"HORIZONTAL\";\n        paint.color.strokeColor.gradientType = \"HORIZONTAL\";\n\n        // Set the swatch color in case the GUI resets it\n        const swatch = document.querySelector(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\n        if (swatch) queueMicrotask(() => {\n            if (!modalStorage._gradCache) return;\n            swatch.style.background = encodeGradHTML(modalStorage._gradCache.settings);\n        });\n\n        const tool = paper.tool;\n        if (typeof tool?._getFillItem !== \"function\") return;\n\n        const item = tool._getFillItem();\n        if (!item) return;\n\n        const bounds = item.bounds;\n        let origin, destination;\n        if (modalStorage.type === \"Radial\") {\n            origin = new paper.Point(tool._point.x, tool._point.y);\n            destination = origin.add([Math.max(bounds.width, bounds.height) / 2, 0]);\n        } else {\n            const points = genLinearGradPoints(bounds, modalStorage.dir - 90);\n            origin = points.origin;\n            destination = points.destination;\n        }\n\n        const path = tool.fillProperty === \"fill\" ? \"fillColor\" : \"strokeColor\";\n        item[path] = {\n            gradient: modalStorage._gradCache.gradient,\n            origin, destination\n        };\n    }\n\n    function handleShapeModeEvent(type) {\n        if (!modalStorage._gradCache && type !== \"TEXT\") return;\n\n        // Set the swatch color in case the GUI resets it\n        const swatch = document.querySelector(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\n        if (swatch) queueMicrotask(() => {\n            if (!modalStorage._gradCache) return;\n            swatch.style.background = encodeGradHTML(modalStorage._gradCache.settings);\n        });\n\n        const tool = paper.tool;\n        if (typeof tool?._onMouseDrag !== \"function\") return;\n        if (tool[symbolTag]) return;\n        // Patch this event, if not already, to run our code\n\n        const funcName = type === \"TEXT\" ? \"onKeyDown\" : \"onMouseDrag\";\n        const ogOnFunc = tool[funcName];\n        tool[symbolTag] = true;\n        tool[funcName] = function (...args) {\n            ogOnFunc.call(this, ...args);\n\n            // Replace the fill with the custom gradient\n            if (!modalStorage._gradCache) {\n                if (type === \"TEXT\") {\n                    tool.element.style.background = \"\";\n                    tool.element.style.backgroundClip = \"\";\n                    tool.element.style.color = \"\";\n                }\n                return;\n            }\n\n            let item;\n            switch (type) {\n                case \"RECT\":\n                    item = this.rect;\n                    break;\n                case \"OVAL\":\n                    item = this.oval;\n                    break;\n                case \"TEXT\":\n                    item = this.textBox;\n                    break;\n                case \"ROUNDED_RECT\":\n                    item = this.rect;\n                    break;\n                case \"TRIANGLE\":\n                    item = this.tri;\n                    break;\n                case \"SUSSY\":\n                    item = this.sussy;\n                    break;\n                case \"ARROW\":\n                    item = this.tri;\n                    break;\n                default: return;\n            }\n            if (!item) return;\n            const bounds = item.bounds;\n            let origin, destination;\n            if (modalStorage.type === \"Radial\") {\n                origin = item.bounds.center;\n                destination = item.bounds.center.add([item.bounds.width / 2, 0]);\n            } else {\n                const points = genLinearGradPoints(bounds, modalStorage.dir - 90);\n                origin = points.origin;\n                destination = points.destination;\n            }\n\n            item.fillColor = {\n                gradient: modalStorage._gradCache.gradient,\n                origin, destination\n            };\n\n            // Text uses HTML elements, so we have to handle that too\n            if (type === \"TEXT\") {\n                tool.element.style.background = encodeGradHTML(modalStorage._gradCache.settings);\n                tool.element.style.backgroundClip = \"text\";\n                tool.element.style.color = \"transparent\";\n            }\n        }\n    }\n\n    // GUI utils\n    function showSelectedGrad(item) {\n        const [fillSwatch, outlineSwatch] = document.querySelectorAll(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\n        const outCSSGrad = paperGrad2CSS(extractGradient(item.strokeColor));\n        if (outlineSwatch) {\n            if (outCSSGrad) outlineSwatch.style.background = outCSSGrad;\n            else if (!item.strokeColor || item.strokeWidth === 0) outlineSwatch.style.background = \"#fff\";\n        }\n\n        const fillGrad = extractGradient(item.fillColor);\n        const fillCSSGrad = paperGrad2CSS(fillGrad);\n        modalStorage._gradCache = undefined;\n        if (fillSwatch) {\n            if (fillCSSGrad) {\n                fillSwatch.style.background = fillCSSGrad;\n\n                // Update cache\n                const { gradient, destination, origin } = fillGrad;\n                modalStorage._gradCache = {\n                    gradient,\n                    settings: {\n                        type: gradient.radial ? \"Radial\" : \"Linear\",\n                        dir: position2Angle(destination, origin),\n                        parts: gradient.stops.map(s => {\n                            const alpha = Math.round(s.color.alpha * 255).toString(16).padStart(2, \"0\");\n                            return { c: s.color.toCSS(true) + alpha, p: s.offset * 100 };\n                        })\n                    }\n                };\n            } else if (!item.fillColor) fillSwatch.style.background = \"#fff\";\n        }\n    }\n\n    function createDraggable(optC, optP) {\n        const index = modalStorage.parts.length;\n        const rngPos = optP ?? Math.floor(Math.random() * 100);\n        const rngHex = optC ?? `#${Math.floor(Math.random() * Math.pow(2, 24)).toString(16).padStart(6, \"0\")}ff`;\n        const opacity = optC ? optC.length === 9 ? parseInt(optC.slice(7, 9), 16) / 255 : 1 : 1;\n\n        const draggable = document.createElement(\"div\");\n        draggable.id = index;\n        draggable.classList.add(\"pointer\");\n        draggable.setAttribute(\"style\", `cursor: pointer; width: 25px; position: absolute; top: -6px; transform: translateX(-50%);`);\n        draggable.style.left = `${rngPos}%`;\n\n        const nub = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n        nub.setAttribute(\"width\", \"14\");\n        nub.setAttribute(\"height\", \"7\");\n        nub.style.transform = \"translateX(45%)\";\n\n        const polygon = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\");\n        polygon.setAttribute(\"points\", \"0,7 7,0 14,7\");\n        polygon.setAttribute(\"stroke\", \"#fff\");\n        polygon.setAttribute(\"fill\", \"#fff\");\n        nub.appendChild(polygon);\n\n        const color = document.createElement(\"div\");\n        color.setAttribute(\"style\", `width: 25px; height: 25px; border-radius: 4px; background: #fff; display: flex; justify-content: center; align-items: center; flex-direction: column;`);\n\n        const colorContainer = document.createElement(\"div\");\n        colorContainer.setAttribute(\"style\", `width: 16px; height: 16px; border-radius: 5px; background: ${rngHex}; border: solid 1px var(--ui-black-transparent); margin-bottom: 2px;`);\n\n        const colorInput = document.createElement(\"input\");\n        colorInput.setAttribute(\"type\", \"color\");\n        colorInput.setAttribute(\"style\", `opacity: 0; position: absolute; pointer-events: none;`);\n\n        const opacityInput = document.createElement(\"input\");\n        opacityInput.setAttribute(\"type\", \"number\");\n        opacityInput.setAttribute(\"min\", \"0\");\n        opacityInput.setAttribute(\"max\", \"100\");\n        opacityInput.value = opacity * 100;\n        opacityInput.setAttribute(\"style\", `visibility: hidden; background: #fff; border: none; color: #000; text-align: center; position: absolute; pointer-events: auto; width: 45px; height: 25px; padding: 0; margin: 0; border-radius: 0 5px 5px 0; left: 22px;`);\n        if (rngPos > 50) {\n            opacityInput.style.removeProperty(\"left\");\n            opacityInput.style.right = \"22px\";\n            opacityInput.style.borderRadius = \"5px 0 0 5px\";\n        }\n\n        // Color picker handler\n        colorContainer.addEventListener(\"click\", (e) => {\n            opacityInput.style.visibility = \"visible\";\n            colorInput.click();\n            e.stopPropagation();\n        });\n        draggable.addEventListener(\"mouseleave\", (e) => {\n            opacityInput.style.visibility = \"hidden\";\n            e.stopPropagation();\n        });\n\n        colorInput.addEventListener(\"input\", (e) => {\n            const alpha = modalStorage.parts[index].c.substring(7, 9);\n            modalStorage.parts[index].c = e.target.value + alpha;\n            colorContainer.style.background = e.target.value + alpha;\n            updateDisplay();\n        });\n\n        // Opacity slider handler\n        opacityInput.addEventListener(\"click\", (e) => {\n            opacityInput.focus();\n            e.stopPropagation();\n        });\n        opacityInput.addEventListener(\"input\", (e) => {\n            const newOpacity = Math.min(100, Math.max(0, e.target.value));\n            e.target.value = newOpacity;\n\n            const alpha = Math.round(newOpacity * 2.55).toString(16).padStart(2, \"0\");\n            const hex = modalStorage.parts[index].c;\n            modalStorage.parts[index].c = hex.substring(0, 7) + alpha;\n            colorContainer.style.background = hex.substring(0, 7) + alpha;\n            updateDisplay();\n        });\n\n        draggable.addEventListener(\"mousedown\", (e) => {\n            e.preventDefault();\n            if (e.target === opacityInput) return;\n\n            modalStorage.selectedPointer = draggable;\n            const container = draggable.parentElement;\n            const containerRect = container.getBoundingClientRect();\n\n            const onMouseMove = (moveEvent) => {\n                const x = moveEvent.clientX - containerRect.left;\n                const percent = Math.min(100, Math.max(0, (x / container.offsetWidth) * 100));\n                draggable.style.left = `${percent}%`;\n                if (percent > 50) {\n                    opacityInput.style.removeProperty(\"left\");\n                    opacityInput.style.right = \"22px\";\n                    opacityInput.style.borderRadius = \"5px 0 0 5px\";\n                } else {\n                    opacityInput.style.left = \"22px\";\n                    opacityInput.style.removeProperty(\"right\");\n                    opacityInput.style.borderRadius = \"0 5px 5px 0\";\n                }\n                modalStorage.parts[index].p = percent;\n                updateDisplay();\n            };\n\n            const onMouseUp = () => {\n                document.removeEventListener(\"mousemove\", onMouseMove);\n                document.removeEventListener(\"mouseup\", onMouseUp);\n            };\n\n            document.addEventListener(\"mousemove\", onMouseMove);\n            document.addEventListener(\"mouseup\", onMouseUp);\n        });\n\n        color.append(colorContainer, colorInput, opacityInput);\n        draggable.append(nub, color);\n        modalStorage.parts.push({ c: rngHex, p: rngPos });\n        modalStorage.selectedPointer = draggable;\n        return draggable;\n    }\n\n    function updateDisplay() {\n        const display = document.querySelector(\".paintGradientMakerPopupDisplay\");\n        if (display) display.style.background = encodeGradHTML(modalStorage);\n    }\n\n    // Main GUI\n    function openGradientMaker() {\n        function genSettingsTable(div) {\n            const btnStyle = `width: 35px; height: 35px; border: solid 1px var(--ui-black-transparent, hsla(0, 0%, 0%, 0.15)); border-radius: 5px; background: var(--paint-input-background, --ui-primary, #fff); transition: transform 0.2s;`;\n            const selectStlye = `cursor: pointer; height: 30px; margin: 5px; border: solid 1px var(--ui-black-transparent); border-radius: 5px; background: var(--ui-secondary);`;\n            const directionStyle = `width: 50px; height: 30px; margin: 5px; border: solid 1px var(--ui-black-transparent); border-radius: 5px; background: var(--ui-secondary);`;\n\n            const createBtn = document.createElement(\"button\");\n            createBtn.setAttribute(\"style\", btnStyle);\n            createBtn.addEventListener(\"click\", (e) => {\n                draggables.appendChild(createDraggable());\n                updateDisplay();\n                e.stopPropagation();\n            });\n\n            const addIcon = addon.tab.recolorable();\n            addIcon.draggable = false;\n            addIcon.src = addon.self.getResource(\"/add.svg\") /* rewritten by pull.js */;\n            createBtn.appendChild(addIcon);\n\n            const deleteBtn = document.createElement(\"button\");\n            deleteBtn.setAttribute(\"style\", btnStyle);\n            deleteBtn.style.margin = \"0px 8px\";\n            deleteBtn.addEventListener(\"click\", (e) => {\n                const pointer = modalStorage.selectedPointer;\n                if (pointer) {\n                    delete modalStorage.selectedPointer;\n                    modalStorage.parts.splice(pointer.id, 1);\n                    const cache = {\n                        parts: modalStorage.parts,\n                        type: modalStorage.type,\n                        dir: modalStorage.dir,\n                    };\n                    modalStorage.parts = [];\n                    draggables.innerHTML = \"\";\n                    decodeFromCache(cache, draggables, settings);\n                    updateDisplay();\n                }\n                e.stopPropagation();\n            });\n\n            const deleteIcon = addon.tab.recolorable();\n            deleteIcon.draggable = false;\n            deleteIcon.src = addon.self.getResource(\"/delete.svg\") /* rewritten by pull.js */;\n            deleteBtn.appendChild(deleteIcon);\n\n            const title1 = document.createElement(\"span\");\n            title1.textContent = \"Gradient Type:\";\n\n            const select = document.createElement(\"select\");\n            select.setAttribute(\"style\", selectStlye);\n\n            const option1 = document.createElement(\"option\");\n            const option2 = document.createElement(\"option\");\n            option1.text = \"Linear\"; option1.value = \"Linear\";\n            option2.text = \"Radial\"; option2.value = \"Radial\";\n            select.append(option1, option2);\n            select.addEventListener(\"change\", (e) => {\n                modalStorage.type = e.target.value;\n                updateDisplay();\n                e.stopPropagation();\n            });\n\n            const title2 = document.createElement(\"span\");\n            title2.textContent = \"Direction:\";\n\n            const dirBtn = document.createElement(\"input\");\n            dirBtn.setAttribute(\"style\", directionStyle);\n            dirBtn.setAttribute(\"type\", \"number\");\n            dirBtn.setAttribute(\"max\", 360);\n            dirBtn.setAttribute(\"min\", 0);\n            dirBtn.setAttribute(\"value\", 90);\n            dirBtn.addEventListener(\"input\", (e) => {\n                modalStorage.dir = e.target.value;\n                updateDisplay();\n                e.stopPropagation();\n            });\n\n            div.append(createBtn, deleteBtn, title1, select, title2, dirBtn);\n        }\n\n        const paint = ReduxStore.getState().scratchPaint;\n        const oldCache = modalStorage._gradCache;\n        modalStorage = {\n            parts: [], type: \"Linear\", dir: 90, selectedPointer: undefined,\n            path: paint.modals.fillColor ? \"fillColor\" : \"strokeColor\",\n        };\n\n        const { backdrop, container, content, closeButton, remove } = addon.tab.createModal(\"Complex Gradient\", {\n            isOpen: true,\n            useEditorClasses: true,\n        });\n        container.classList.add(\"paintGradientMakerPopup\");\n        content.classList.add(\"paintGradientMakerPopupContent\");\n\n        backdrop.addEventListener(\"click\", remove);\n        closeButton.addEventListener(\"click\", remove);\n\n        const buttonRow = Object.assign(document.createElement(\"div\"), {\n            className: addon.tab.scratchClass(\"prompt_button-row\", { others: \"paintGradientMakerPopupButtons\" }),\n        });\n        const cancelButton = Object.assign(document.createElement(\"button\"), {\n            textContent: \"Cancel\",\n        });\n        cancelButton.addEventListener(\"click\", remove, { once: true });\n        buttonRow.appendChild(cancelButton);\n        const startButton = Object.assign(document.createElement(\"button\"), {\n            textContent: \"OK\",\n            className: addon.tab.scratchClass(\"prompt_ok-button\"),\n        });\n        startButton.addEventListener(\n            \"click\",\n            () => {\n                setSelected2Grad(modalStorage);\n                remove();\n            },\n            { once: true },\n        );\n        buttonRow.appendChild(startButton);\n\n        // Color display\n        const display = document.createElement(\"div\");\n        display.classList.add(\"paintGradientMakerPopupDisplay\");\n\n        // Draggables space\n        const draggables = document.createElement(\"div\");\n        draggables.classList.add(\"paintGradientMakerPopupDraggables\");\n\n        // Settings\n        const settings = document.createElement(\"div\");\n        settings.classList.add(\"paintGradientMakerPopupSettings\");\n        genSettingsTable(settings);\n\n        content.append(display, draggables, settings, buttonRow);\n\n        if (paint.selectedItems?.length) decodeSelectedGrad(paint.selectedItems[0], draggables, settings);\n        else if (oldCache) decodeFromCache(oldCache.settings, draggables, settings);\n        else draggables.append(createDraggable(), createDraggable());\n        updateDisplay();\n    }\n\n    function startListenerWorker() {\n        let lastMode, lastSelected, lastModals;\n        ReduxStore.subscribe(() => {\n            const paint = ReduxStore.getState().scratchPaint;\n            if (!paint || paint?.format === undefined || paint?.format === null) return;\n            const { mode, selectedItems, modals } = paint;\n\n            // No bitmap support\n            if (paint.format.startsWith(\"BITMAP\")) {\n                if (customBtn) {\n                    customBtn.remove();\n                    customBtn = undefined;\n                }\n                return;\n            }\n\n            // Run relative tool events\n            if (mode === \"FILL\") handleFillEvent(paint);\n            else if (paperLinkModes.has(mode)) handleShapeModeEvent(mode);\n\n            const idChain = selectedItems.map((e) => e.id).join(\".\");\n            const modalChain = `${modals.fillColor}${modals.strokeColor}`;\n            if (mode === lastMode && idChain === lastSelected && modalChain === lastModals) return;\n            lastMode = mode;\n            lastSelected = idChain;\n            lastModals = modalChain;\n\n            // Decode potential custom gradients\n            if (selectedItems?.length) showSelectedGrad(selectedItems[0]);\n            else if (mode === \"SELECT\" || mode === \"RESHAPE\") modalStorage._gradCache = undefined;\n\n            // Add custom modal\n            if (!modals.strokeColor && !modals.fillColor) return;\n            if (observerUsed) return;\n            const observer = new MutationObserver(() => {\n                const gradRow = document.querySelector(`div[class^=\"color-picker_gradient-picker-row_\"]`);\n                if (!gradRow || gradRow.lastElementChild.id === customID) return;\n\n                // Get the appropriate class names for selected items\n                if (!selectedClassName) initGradSelectClasses(gradRow);\n                const children = Array.from(gradRow.children);\n\n                let selectIcon = addon.self.getResource(\"/fill-complex-gradient-enabled.svg\") /* rewritten by pull.js */;\n                selectIcon = \"data:image/svg+xml;base64,\" + btoa(selectIcon.replace(\n                    \"#855cd6\",\n                    document.documentElement.style.getPropertyValue(\"--looks-secondary\"),\n                ));\n  \n                customBtn = children[0].cloneNode(true);\n                customBtn.src = selectIcon;\n                customBtn.id = customID;\n                customBtn.setAttribute(\"class\", unselectedClassName);\n                gradRow.appendChild(customBtn);\n\n                gradRow.addEventListener(\"click\", (e) => {\n                    if (e.target === customBtn) {\n                        for (const child of children) child.setAttribute(\"class\", unselectedClassName);\n                        customBtn.setAttribute(\"class\", selectedClassName);\n                        openGradientMaker();\n                    } else if (e.target.nodeName === \"IMG\") {\n                        modalStorage._gradCache = undefined;\n                        customBtn.setAttribute(\"class\", unselectedClassName);\n                    }\n                });\n\n                observerUsed = false;\n                observer.disconnect();\n            });\n\n            observer.observe(document.body, { childList: true, subtree: true });\n            observerUsed = true;\n        });\n    }\n\n    if (typeof scaffolding === \"undefined\") startListenerWorker();\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACZA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;A","sourceRoot":""}